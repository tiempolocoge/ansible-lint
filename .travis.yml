# Based on https://github.com/pantsbuild/pex/blob/master/.travis.yml
#
# Enables support for a docker container-based build
# which should provide faster startup times and beefier
# "machines".
# See: http://docs.travis-ci.com/user/workers/container-based-infrastructure/
sudo: false

# TRAVIS_PYTHON_VERSION

jobs:
  fast_finish: true

  include:
    - language: python
      python: "2.7"
      env: TOXENV=py27-flake8

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible19

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible20

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible21

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible22

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible23

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible24

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansible25

    - language: python
      python: "2.7"
      env: TOXENV=py27-ansibledevel

    - language: python
      python: "3.6"
      env: TOXENV=py36-ansible22

    - language: python
      python: "3.6"
      env: TOXENV=py36-ansible23

    - language: python
      python: "3.6"
      env: TOXENV=py36-ansible24

    - language: python
      python: "3.6"
      env: TOXENV=py36-ansible25

    - language: python
      python: "3.6"
      env: TOXENV=py36-ansibledevel

    - language: python
      python: "3.6"
      env: TOXENV=py36-flake8

    - &deploy-job
      stage: Deploy
      name: Publishing current Git tagged version of dist to PyPI
      if: tag IS present
      language: python
      python: "3.6"
      env:
        TOXENV: metadata-validation
      deploy: &deploy-step
        provider: pypi
        user: any-maintainer-on-pypi  # I recommend having a separate account
        password:
          secure: >  # needs real data
            PLACE_FOR_AN_ENCRYPTED_STRING
        distributions: dists
        skip-cleanup: true
        on:
          tags: true
          all_branches: true

    - <<: *deploy-job
      if: type != pull_request  # Always run, except if PR
      deploy:
        <<: *deploy-step
        server: https://test.pypi.org/legacy/

install:
  - pip install -r test-deps.txt

before_script:
- git fetch --unshallow

script:
- tox -v
